name: CICD
on:
#  push:
#    branches:
#      - 'main'
#      - 'releases/**'
  pull_request:
    types: [opened, synchronize]
  workflow_dispatch:

jobs:
  build:
    name: Build
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Install stable toolchain
        uses: actions-rs/toolchain@v1
        with:
          toolchain: stable
          override: true

#      - name: Cross build with all features
#        uses: actions-rs/cargo@v1
#        with:
#          use-cross: true 
#          command: build
#          args: --release --target x86_64-unknown-linux-musl --all-features --verbose

      - name: Setup Cargo Lambda
        uses: zerj9/setup-cargo-lambda@v0.1.0

      - name: Setup Zig
        uses: goto-bus-stop/setup-zig@v1.3.0

      - name: Cargo lambda build
        run: |
          cargo lambda build --output-format zip --release

#  ci:
#    name: Continuous Integration
#    runs-on: ubuntu-latest
#    steps:
#      - name: Checkout repository
#        uses: actions/checkout@v2

#      - name: Install stable toolchain
#        uses: actions-rs/toolchain@v1
#        with:
#          toolchain: stable
#          override: true

#      - name: Setup Cargo Lambda
#        uses: zerj9/setup-cargo-lambda@v0.1.0

#      - name: Install cargo watch
#        run: |
#          cargo install cargo-watch

#      - name: Cargo lambda watch, invoke and cargo test
#        run: |
#          cargo lambda watch &
#          sleep 5
#          cargo lambda invoke lambda_function_01 --data-ascii "{}"
#          cargo test -- --test-threads=1
